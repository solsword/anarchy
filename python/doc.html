<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Peter Mawhorter (pmawhorter@gmail.com)" />
  <title>Anarchy Library Documentation</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">Anarchy Library Documentation</h1>
<p class="author">Peter Mawhorter (pmawhorter@gmail.com)</p>
</header>
<p><code>anarchy</code> is a library for generating random numbers in an incremental and reversible fashion. It also has routines for incremental shuffling and distribution of items. The goal is to give a high level of control to designers of PCG systems while maintaining incremental operation as is necessary in incrementally-generated open-world situations.</p>
<p>However, it can also be used in simpler situations as it provides a variety of built-in convenience functions like pseudo-gaussian and exponentially-distributed random numbers (these are not reversible).</p>
<h2 id="replacing-random">Replacing <code>random()</code></h2>
<p>The incremental shuffling algorithm can be used as a replacement for a standard random number generator in cases where you want to guarantee a global distribution of items and are currently using independent random number checks to control item distribution. For example, if you have code that looks like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">def</span> roll_item():</span>
<span id="cb1-2"><a href="#cb1-2"></a>  r <span class="op">=</span> random.random()</span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="cf">if</span> r <span class="op">&lt;</span> <span class="fl">0.01</span>: <span class="co"># 1% chance for Rare item</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="cf">return</span> <span class="st">&quot;Rare&quot;</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  <span class="cf">elif</span> r <span class="op">&lt;</span> <span class="fl">0.06</span>: <span class="co"># 5% chance for Uncommon item</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="cf">return</span> <span class="st">&quot;Uncommon&quot;</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="cf">else</span>:</span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="cf">return</span> <span class="st">&quot;Common&quot;</span></span></code></pre></div>
<p>You have no guarantees about exactly how often rare/uncommon items will be, and some players will get lucky or unlucky. Instead, even if you don’t know the number of roll_item calls, with <code>anarchy</code> you can do this:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a>N <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>seed <span class="op">=</span> <span class="dv">472389223</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">def</span> roll_item():</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="kw">global</span> N, seed</span>
<span id="cb2-6"><a href="#cb2-6"></a>  r <span class="op">=</span> anarchy.cohort_shuffle(N, <span class="dv">100</span>, seed <span class="op">+</span> N<span class="op">//</span><span class="dv">100</span>)</span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="cf">if</span> r <span class="op">&lt;</span> <span class="dv">1</span>:</span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="cf">return</span> <span class="st">&quot;Rare&quot;</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="cf">elif</span> r <span class="op">&lt;</span> <span class="dv">6</span>:</span>
<span id="cb2-10"><a href="#cb2-10"></a>    <span class="cf">return</span> <span class="st">&quot;Uncommon&quot;</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="cf">else</span>:</span>
<span id="cb2-12"><a href="#cb2-12"></a>    <span class="cf">return</span> <span class="st">&quot;Common&quot;</span></span></code></pre></div>
<p>In this code there are two extra variables that have to be managed in some way, but the benefit is that for every 100 calls to the function, “Rare” will be returned exactly once, and “Uncommon” will be returned exactly 5 times. Each group of 100 calls will still have a different ordering of the items, because it uses a different seed.</p>
<p>There are many other potential applications of reversible/incremental shuffling; this is one of the most direct.</p>
<h2 id="core-functions">Core Functions</h2>
<p>(Note: these are the most useful functions available but there are others, like the individual reversible operations used for shuffling or random number generation. Those functions are documented in the source code.)</p>
<h3 id="single-number-functions">Single Number Functions</h3>
<p>Deal with individual random numbers.</p>
<ul>
<li><a href="#prng"><code>prng</code></a></li>
<li><a href="#rev_prng"><code>rev_prng</code></a></li>
<li><a href="#udist"><code>udist</code></a></li>
<li><a href="#pgdist"><code>pgdist</code></a></li>
<li><a href="#flip"><code>flip</code></a></li>
<li><a href="#idist"><code>idist</code></a></li>
<li><a href="#expdist"><code>expdist</code></a></li>
</ul>
<h3 id="prng"><code>prng</code></h3>
<p>A simple reversible pseudo-random number generator.</p>
<h3 id="rev_prng"><code>rev_prng</code></h3>
<p>Inverse of prng (see above).</p>
<h3 id="udist"><code>udist</code></h3>
<p>Generates a random floating-point number between 0 (inclusive) and 1 (exclusive) given a seed value.</p>
<h3 id="pgdist"><code>pgdist</code></h3>
<p>Generates a floating point number between 0 (inclusive) and 1 (exclusive) with a pseudo-gaussian distribution by averaging three uniform numbers over that range.</p>
<h3 id="flip"><code>flip</code></h3>
<p>Flips a biased coin with probability p of being true. Using the same seed always gives the same result.</p>
<h3 id="idist"><code>idist</code></h3>
<p>Even distribution over the given integer range, including the lower end but excluding the higher end (even if the lower end is given second). Distribution bias is about one part in (range/2^63).</p>
<h3 id="expdist"><code>expdist</code></h3>
<p>Generates a number from an exponential distribution with mean 0.5 given a seed.</p>
<p>See: https://math.stackexchange.com/questions/28004/random-exponential-like-distribution</p>
<h3 id="cohort-functions">Cohort Functions</h3>
<p>Deal similarly with numbers from a range.</p>
<ul>
<li><a href="#cohort"><code>cohort</code></a></li>
<li><a href="#cohort_inner"><code>cohort_inner</code></a></li>
<li><a href="#cohort_outer"><code>cohort_outer</code></a></li>
<li><a href="#cohort_shuffle"><code>cohort_shuffle</code></a></li>
<li><a href="#rev_cohort_shuffle"><code>rev_cohort_shuffle</code></a></li>
<li><a href="#distribution_portion"><code>distribution_portion</code></a></li>
<li><a href="#distribution_prior_sum"><code>distribution_prior_sum</code></a></li>
<li><a href="#distribution_segment"><code>distribution_segment</code></a></li>
</ul>
<h3 id="cohort"><code>cohort</code></h3>
<p>Computes cohort number for the given outer index and cohort size.</p>
<h3 id="cohort_inner"><code>cohort_inner</code></h3>
<p>Computes within-cohort index for the given outer index and cohorts of the given size.</p>
<h3 id="cohort_outer"><code>cohort_outer</code></h3>
<p>Inverse of cohort_and_inner computes the outer index from a cohort number and inner index.</p>
<h3 id="cohort_shuffle"><code>cohort_shuffle</code></h3>
<p>Compose a bunch of the above functions to perform a nice thorough shuffle within a cohort.</p>
<h3 id="rev_cohort_shuffle"><code>rev_cohort_shuffle</code></h3>
<p>Inverse shuffle (see above).</p>
<h3 id="distribution_portion"><code>distribution_portion</code></h3>
<p>Given that ‘total’ items are to be distributed evenly among ‘n_segment’ segments each with at most ‘segment_capacity’ items and we’re in segment ‘segment’ of those, computes how many items are in this segment. The ‘roughness’ argument should be a number between 0 and 1 indicating how even the distribution is: 0 indicates a perfectly even distribution, while 1 indicates a perfectly random distribution. Does work proportional to the log of the number of segments.</p>
<p>Note that segment_capacity * n_segments should be &gt; total.</p>
<h3 id="distribution_prior_sum"><code>distribution_prior_sum</code></h3>
<p>Does similar math to the distribution_portion function above, but instead of returning the number of items in the given segment, it returns the number of items in all segments before the given segment. Only does work proportional to the log of the number of segments.</p>
<h3 id="distribution_segment"><code>distribution_segment</code></h3>
<p>Computes the segment number in which a certain item appears (one of the ‘total’ items distributed between segments; see distribution_portion above). Requires work proportional to the log of the number of segments.</p>
</body>
</html>
